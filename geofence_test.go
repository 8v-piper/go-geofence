package geofence

import (
	"testing"

	"github.com/kellydunn/golang-geo"
	"github.com/stretchr/testify/assert"
)

func TestGeofenceInit(t *testing.T) {
	// Chicago geofence
	polygon := []*geo.Point{
		geo.NewPoint(42.01313565896657, -87.89133314508945),
		geo.NewPoint(42.01086525470408, -87.94498134870082),
		geo.NewPoint(41.955566495567936, -87.94566393946297),
		geo.NewPoint(41.937218295745865, -87.88581848144531),
		geo.NewPoint(41.96295962052549, -87.86811594385654),
		geo.NewPoint(41.93385557339662, -87.86333084106445),
		geo.NewPoint(41.934494079111666, -87.81011581420898),
		geo.NewPoint(41.90554916282452, -87.80925750732422),
		geo.NewPoint(41.9058827519221, -87.77938842773438),
		geo.NewPoint(41.86402837073972, -87.77792931126896),
		geo.NewPoint(41.864284053216565, -87.75638580846135),
		geo.NewPoint(41.82348977579423, -87.75552751729265),
		geo.NewPoint(41.823042045417644, -87.80410768697038),
		geo.NewPoint(41.771468158020106, -87.80324938008562),
		geo.NewPoint(41.772364335324305, -87.74625778198242),
		geo.NewPoint(41.730894639311565, -87.74513235432096),
		geo.NewPoint(41.73166805909664, -87.6870346069336),
		geo.NewPoint(41.71748939617332, -87.68600471266836),
		geo.NewPoint(41.716966221614854, -87.7243280201219),
		geo.NewPoint(41.69405798811367, -87.72351264953613),
		geo.NewPoint(41.693865716655395, -87.74385454365984),
		geo.NewPoint(41.67463566843159, -87.74299623677507),
		geo.NewPoint(41.67550471265456, -87.6654052734375),
		geo.NewPoint(41.651683859743336, -87.66489028930664),
		geo.NewPoint(41.65181212480582, -87.64789581298828),
		geo.NewPoint(41.652036588050684, -87.62532234191895),
		geo.NewPoint(41.643100214173714, -87.62506484985352),
		geo.NewPoint(41.643492184875946, -87.51889228820801),
		geo.NewPoint(41.642929165686375, -87.38588330335915),
		geo.NewPoint(41.836600482955916, -87.43858338799328),
		geo.NewPoint(42.05042567111704, -87.40253437310457),
		geo.NewPoint(42.070116505457364, -87.47205723077059),
		geo.NewPoint(42.0681413002819, -87.66792302951217),
		geo.NewPoint(42.02862488227374, -87.66551960259676),
		geo.NewPoint(42.0280511074349, -87.71289814263582),
		geo.NewPoint(41.998468275360544, -87.71301263943315),
		geo.NewPoint(41.9988509912138, -87.75069231167436),
		geo.NewPoint(42.02100207763309, -87.77704238542356),
		geo.NewPoint(42.02010937741473, -87.831029893714),
		geo.NewPoint(41.98719839843826, -87.83120155116194),
		geo.NewPoint(41.9948536336077, -87.86373138340423),
	}

	points := [][]*geo.Point{polygon}
	geofence := NewGeofence(points)

	assert.Equal(t, geofence.granularity, int64(20))
	assert.Equal(t, geofence.vertices, polygon)
	assert.Equal(t, geofence.minX, 41.642929165686375)
	assert.Equal(t, geofence.minY, -87.94566393946297)
	assert.Equal(t, geofence.maxX, 42.070116505457364)
	assert.Equal(t, geofence.maxY, -87.38588330335915)
}
